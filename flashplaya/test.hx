import flash.events.SampleDataEvent;import flash.media.Sound;import flash.external.ExternalInterface;import flash.net.URLVariables;import flash.Vector;import flash.display.Graphics;import flash.utils.ByteArray;class Test {  static function base64Decode(input: String) : Array<Int> {    var BASE64:String = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";    var output:Array<Int> = [];    var enc1 = BASE64.indexOf(input.charAt(0));    var enc2 = BASE64.indexOf(input.charAt(1));    var enc3 = BASE64.indexOf(input.charAt(2));    var enc4 = BASE64.indexOf(input.charAt(3));    var chr1 = (enc1 << 2) | (enc2 >> 4);    var chr2 = ((enc2 & 15) << 4) | (enc3 >> 2);    var chr3 = ((enc3 & 3) << 6) | enc4;    output.push(chr1 & 0xFF);    if (enc3 != 64) {      output.push(chr2 & 0xFF);    }    if (enc4 != 64) {      output.push(chr3 & 0xFF);    }    return output;  }    static function sineWaveGenerator(event:SampleDataEvent) {      if(ExternalInterface.available) {        try {          var data:String = ExternalInterface.call("genSound", 4096, event.position);          var len:Int = Math.floor(data.length / 4);          var bytes:ByteArray = new ByteArray();          for(i in 0...len) {            var decoded: Array<Int> = base64Decode(data.substr(i*4, 4));            var decodedLen = decoded.length;            for(j in 0...decodedLen) {              bytes.writeByte(decoded[j]);            }          }          len = Math.floor(bytes.length / 2);          bytes.position = 0;          for(i in 0...len) {            var dings:Int = 0;            dings += bytes.readUnsignedByte();            dings += bytes.readUnsignedByte() << 8;            var val:Float = (dings - 32768.0) / 32768.0;            event.data.writeFloat(val);            event.data.writeFloat(val);          }        } catch (msg:Dynamic) {          trace(msg);        }      }    }    static function main() {      trace("Started V0.2");      flash.system.Security.allowDomain("localhost");      // trace(flash.system.Security.sandboxType);      var mySound:Sound = new Sound();      mySound.addEventListener(SampleDataEvent.SAMPLE_DATA,sineWaveGenerator);      mySound.play();    }}